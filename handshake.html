<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>音声通信ハンドシェイクテスト</title>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <div class="wrap">
    <h1>音声通信ハンドシェイクテスト</h1>
    <p class="hint">
      このページでは、送信と受信を同じ画面で扱い、<br />
      「送信許可申請 → 許可 → データ送信 → 成否通知」を手動で確認します。<br />
      まずは A 側が「受信開始」、B 側が「送信許可申請」を送ってみてください。
    </p>

    <!-- ======== 受信パネル ======== -->
    <section>
      <h2>🎧 受信（A側想定）</h2>
      <div class="row">
        <div>
          <label for="br">ビットレート (bps)</label>
          <input id="br" type="number" value="30" min="10" max="1000" step="10" />
        </div>
        <div>
          <label for="f0">f<sub>0</sub> (Hz, 0の周波数)</label>
          <input id="f0" type="number" value="1400" />
        </div>
        <div>
          <label for="f1">f<sub>1</sub> (Hz, 1の周波数)</label>
          <input id="f1" type="number" value="2200" />
        </div>
      </div>

      <label style="margin-top:.5rem; display:block;">
        <input id="useHammingRx" type="checkbox" checked />
        Hamming(7,4) でエラー訂正してから復号する
      </label>

      <div class="ctrls">
        <button id="start" class="primary">録音開始</button>
        <button id="stop" disabled>停止</button>
        <button id="decode" disabled>解析（復調）</button>
      </div>

      <p id="status" class="hint">準備OK。</p>

      <h3>復調結果（ビット列）</h3>
      <div id="result" class="mono"></div>

      <h3>ひらがなメッセージ</h3>
      <div id="decodedHira" class="mono"></div>

      <audio id="recPlayer" controls></audio>
      <p class="small">録音した音声をそのまま再生します。</p>

      <h3>ログ</h3>
      <div id="log" class="log mono"></div>
    </section>

    <hr style="margin:3rem 0; border:none; border-top:1px solid #eee;" />

    <!-- ======== 送信パネル ======== -->
    <section>
      <h2>🔊 送信（B側想定）</h2>

      <label for="hira">ひらがなメッセージ</label>
      <textarea id="hira" placeholder="例) こんにちは"></textarea>

      <div class="ctrls">
        <button id="encodePlay" class="primary">ひらがなを送信</button>
      </div>

      <div class="hint small">以下はハンドシェイク信号のショートカットです。</div>
      <div class="ctrls">
        <button class="primary" id="sendReqBtn">送信許可申請 (REQ)</button>
        <button id="sendPermitBtn">送信許可 (PERMIT)</button>
        <button id="sendOkBtn">受信成功 (OK)</button>
        <button id="sendNgBtn">受信失敗 (NG)</button>
      </div>

      <audio id="player" controls></audio>

      <pre id="debug-log" style="
        max-height: 40vh;
        padding: 8px;
        margin: 0;
        font-size: 10px;
        background: rgba(0,0,0,0.8);
        color: #0f0;
        overflow-y: auto;
      "></pre>
    </section>
  </div>

  <footer>
    <div class="nav-btns">
      <a href="./sending.html"><button>🔊 Sending</button></a>
      <a href="./receiving.html"><button>🎧 Receiving</button></a>
    </div>
  </footer>

    <!-- 既存のスクリプト群（読み込み順はプロジェクトに合わせて調整） -->
    <script src="sound-utils.js"></script>
    <script src="hamming-codec.js"></script>
    <script src="kana-codec.js"></script>
    <script src="protocol.js"></script>
    <script src="sending.js"></script>
    <script src="receiving.js"></script>

    <!-- ハンドシェイク用 UI ロジック -->
    <script src="handshake.js"></script>
  </body>
</html>
</body>
</html>